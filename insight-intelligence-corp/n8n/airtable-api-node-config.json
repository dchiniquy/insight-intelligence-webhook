{
  "name": "Create Airtable Lead",
  "type": "n8n-nodes-base.httpRequest",
  "typeVersion": 4.2,
  "position": [-750, 350],
  "id": "create-airtable-lead",
  "parameters": {
    "method": "POST",
    "url": "=https://api.airtable.com/v0/{{ $credentials.airtableConfig.baseId }}/Incomplete%20Leads",
    "authentication": "predefinedCredentialType",
    "nodeCredentialType": "httpHeaderAuth",
    "sendHeaders": true,
    "headerParameters": {
      "parameters": [
        {
          "name": "Content-Type",
          "value": "application/json"
        },
        {
          "name": "Authorization", 
          "value": "=Bearer {{ $credentials.airtableConfig.accessToken }}"
        }
      ]
    },
    "sendBody": true,
    "specifyBody": "json",
    "jsonBody": "={{ {\n  records: [{\n    fields: {\n      firstName: $node['Extract Contact Details'].json.firstName,\n      lastName: $node['Extract Contact Details'].json.lastName,\n      phone: $node['Extract Contact Details'].json.phone,\n      message: $node['Extract Message Data'].json.message,\n      sessionId: $node['Extract Message Data'].json.sessionId,\n      timestamp: new Date().toISOString(),\n      leadSource: 'chat',\n      intentClassification: JSON.stringify($node['Process Intent Classification'].json),\n      primaryIntent: $node['Process Intent Classification'].json.primary_intent,\n      leadQuality: $node['Process Intent Classification'].json.lead_quality,\n      urgencyLevel: $node['Process Intent Classification'].json.urgency_level,\n      vapiCallStatus: 'pending',\n      status: 'new'\n    }\n  }]\n} }}",
    "options": {
      "timeout": 10000,
      "retry": {
        "enabled": true,
        "maxAttempts": 3,
        "waitBetween": 1000
      }
    }
  },
  "credentials": {
    "httpHeaderAuth": {
      "id": "airtable-auth-header",
      "name": "Airtable API Auth"
    }
  }
}